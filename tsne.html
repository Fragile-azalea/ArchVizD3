<!DOCTYPE html>
<html>

<head>
    <title>t-SNE Visualization with D3.js</title>
    <!-- Include D3.js from CDN -->
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <style>
        .axis line,
        .axis path {
            stroke: black;
        }

        .axis text {
            font-family: sans-serif;
            font-size: 10px;
        }

        circle {
            opacity: 0.7;
        }
    </style>
</head>

<body>
    <!-- The SVG element that will contain our visualization -->
    <svg id="tsne-scatter-plot" width="800" height="600"></svg>

    <script>

        // Load the t-SNE data from a JSON file
        d3.json('data/tsne_nb201_output.json').then(function (data) {
            // Transform the data into an array
            var tsneData = Object.entries(data).map(([key, value]) => {
                return { ...value, label: key }; // Spread the value object and add the 'label' property
            });
            console.log(tsneData);
            // The rest of your visualization code goes here
            // Set the dimensions and margins of the graph
            var margin = { top: 10, right: 30, bottom: 30, left: 40 },
                width = 800 - margin.left - margin.right,
                height = 600 - margin.top - margin.bottom;

            // Append the svg object to the body of the page
            var svg_tsne = d3.select("#tsne-scatter-plot")
                .attr("width", width + margin.left + margin.right)
                .attr("height", height + margin.top + margin.bottom)
                .append("g")
                .attr("transform",
                    "translate(" + margin.left + "," + margin.top + ")");

            // Create a tooltip
            var tooltip = d3.select("body").append("div")
                .attr("class", "tooltip")
                .style("opacity", 0)
                .style("background-color", "white")
                .style("border", "solid")
                .style("border-width", "2px")
                .style("border-radius", "5px")
                .style("padding", "5px");

            // Add X axis
            var x = d3.scaleLinear()
                .domain([d3.min(tsneData, d => d.x1), d3.max(tsneData, d => d.x1)])
                .range([0, width]);
            svg_tsne.append("g")
                .attr("transform", "translate(0," + height + ")")
                .call(d3.axisBottom(x));

            // Add Y axis
            var y = d3.scaleLinear()
                .domain([d3.min(tsneData, d => d.x2), d3.max(tsneData, d => d.x2)])
                .range([height, 0]);
            svg_tsne.append("g")
                .call(d3.axisLeft(y));

            // Color scale
            var color = d3.scaleOrdinal()
                .domain(tsneData.map(d => d.color))
                .range(d3.schemeCategory10);

            // Add dots
            svg_tsne.append('g')
                .selectAll("dot")
                .data(tsneData)
                .enter()
                .append("circle")
                .attr("cx", d => x(d.x1))
                .attr("cy", d => y(d.x2))
                .attr("r", 5)
                .style("fill", d => color(d.color))
                // Tooltip code
                .on("mouseover", function (event, d) {
                    tooltip.transition()
                        .duration(200)
                        .style("opacity", .9);
                    tooltip.html("Color: " + d.color + "<br/>X1: " + d.x1 + "<br/>X2: " + d.x2)
                        .style("left", (event.pageX) + "px")
                        .style("top", (event.pageY - 28) + "px");
                })
                .on("mouseout", function (d) {
                    tooltip.transition()
                        .duration(500)
                        .style("opacity", 0);
                });

        }).catch(function (error) {
            // Handle error here
            console.log(error);
        });



    </script>
</body>

</html>